#include <behaviors.dtsi>
#include <dt-bindings/zmk/bt.h>
#include "keycode_japanese.h"
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/pointing.h>


#define ZMK_POINTING_DEFAULT_SCRL_VAL 80

&mt { 
    flavor = "balanced"; 
    tapping-term-ms = <200>;
    quick-tap-ms = <150>; 
};

&lt {
    flavor = "balanced";
    tapping-term-ms = <200>; 
    quick-tap-ms = <150>; 
};


//    0  1  2  3  4  5              6  7  8  9  10 
//    14 15 16 17 18 19          20 21 22 23 24 25
//    26 27 28 29 30 31          32 33 34 35 36 37
//    38 39 40 41 42 43          44 45       46 47


/ {
    combos { compatible = "zmk,combos"; 

        lang {
            bindings = <&kp GRAVE>;
            key-positions = <1 3>;
            layers = <0>;
            timeout-ms = <200>;
        };

        fopen {
            bindings = <&kp LG(N2)>;
            key-positions = <7 9>;
            layers = <0>;
            timeout-ms = <200>;
        };

       bootloader_R {
            bindings = <&bootloader>;
            key-positions = <6 10>;
            timeout-ms = <200>;
        };

       bootloader_L {
            bindings = <&bootloader>;
            key-positions = <0 4>;
            timeout-ms = <200>;
        };

        eq {
            bindings = <&bt BT_CLR_ALL>;
            key-positions = <8 20 32 34>;
            timeout-ms = <50>;
            layers = <0>;
        };

        bt0 {
            bindings = <&bt BT_SEL 0>;
            key-positions = <9 21 33>;
            timeout-ms = <50>;
            layers = <0>;
        };

     };

};


/ {
    behaviors {
        rot_kp: sensor_rotate_kp {
            compatible = "zmk,behavior-sensor-rotate-var";
            #sensor-binding-cells = <2>;
            bindings = <&kp>, <&kp>;
        };
    };

    keymap {
        compatible = "zmk,keymap";


        default_layer {
            bindings = <
                &kp ESCAPE          &kp Q        &kp E      &kp U         &kp P      &kp ESC                            &kp D        &kp T         &kp R       &lt 5 W  &kp T
                &kp A        &kp O        &kp E        &kp I        &kp U        &kp SCROLLLOCK                     &kp G        &kp N        &kp T        &kp S        &kp K
                &kp X        &kp C        &kp V        &kp W        &kp Q        &kp TAB                            &kp J        &kp H        &kp M        &kp B        &kp Z
                &kp LSHIFT                             &lt 1 LANGUAGE_1 &kp SPACE &kp LEFT_WIN       &kp F      &kp RSHIFT   &kp ENTER    &lt 3 LANGUAGE_2      &mo 2
            >;
            sensor-bindings = <&rot_kp PG_DN PG_UP>;
        };
    
            // ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            // |    /           |       ,       |       END     |     （        |      ”        |    PAUSE_BREAK|                  |            |      （       |       ）     |        ↑      |        [      |      ]      |
            // |    HOME        |       C_SAVE  |       END     |       ）      |       U       |    SCROLLLOCK |                  |            |   Backspace   |       ←      |        ↓      |        →      |     DEL     |
            // |    UNDO        |       CUT     |       COPY    |       PASTE   |       Q       |    TAB        |                  |   PSCRN    |    ' / "      |    = / +     |    \ / |      |    ` / ~      |    INS      |
            // |    L_SHIFT     |               |               |       none    |    SPACE      |    LALT       |                  |   RSHIFT   |   ENTER       |       FUN_L  |               |               |    RCTRL    |
            // ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        Lower_layer {
            bindings = <
                &kp FSLH    &kp COMMA    &kp END        &kp LEFT_BRACE  &kp DOUBLE_QUOTES   &kp PAUSE_BREAK                 &kp LPAR          &kp RPAR      &kp UP       &kp LBKT     &kp RBKT
                &kp HOME    &kp LS(S)    &kp E          &kp RPAR        &kp U               &kp SCROLLLOCK                  &kp BSPC          &kp LEFT      &kp DOWN     &kp RIGHT    &kp DEL
                &kp LC(Z)   &kp LC(X)    &kp LC(C)      &kp LC(V)       &kp Q               &kp TAB                         &kp APOS          &kp EQUAL     &kp BSLH     &kp GRAVE    &kp INS
                &kp LSHIFT                              &none           &kp SPACE           &kp LALT            &kp PSCRN   &kp RSHIFT        &kp ENTER     &mo 4                &kp RCTRL
            >;  
        };

            // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            // |    /           |       ,        |       END     |       {       |       ’      |    ESC        |                  |            |      L      |      R         |    PG_UP      |     {       |      }      |
            // |    HOME        |       C_SAVE   |       END     |       }       |       U      |    LCTRL      |                  |            |  Backspace  |    HOME        |    PG_DN      |    END      |    DEL      |
            // |    UNDO        |       CUT      |       COPY    |       PASTE   |       Q      |    TAB        |                  |      F     |    ' / "    |    = / +       |    \ / |      |    ` / ~    |    INS      |
            // |    L_SHIFT     |                |               |       BT_L    |      SPACE   |    LALT       |                  |   ENTER    |    none     |   R_SHIFT      |               |             |   R_SHIFT   |
            // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        Lower2_layer {
            bindings = <
                &none        &kp COMMA    &kp END      &kp LEFT_BRACE       &kp SINGLE_QUOTE    &kp ESC                             &kp L           &kp R        &kp PG_UP       &kp LBKT       &kp RBRC
                &kp HOME     &kp LS(S)    &kp END      &kp RIGHT_BRACE      &kp U               &kp LCTRL                           &kp BSPC        &kp HOME     &kp PG_DN       &kp END        &kp DEL
                &kp LC(Z)    &kp LC(X)    &kp LC(C)    &kp LC(V)            &kp Q               &kp TAB                             &kp APOS        &kp EQUAL    &kp BSLH        &kp GRAVE      &kp INS
                &kp LSHIFT                             &mo 5             &kp SPACE           &kp LALT                &kp PSCRN   &kp RSHIFT      &kp ENTER    &none                          &kp RSHIFT
            >;
        };

            // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            // |        1       |      2        |       3       |       4       |       5       |    ESC        |               |            |      6       |      7        |       8       |       9       |       0       |
            // |        !       |      @        |       #       |       $       |       %       |    none       |               |            |      ^       |      &        |       *       |       (       |       )       | 
            // |        F1      |     F2        |     F3        |       F4      |       F5      |    TAB        |               |     F11    |    ' / "     |    = / +      |    \ / |      |    ` / ~      |       INS     |
            // |    L_SHIFT     |               |               | En / LOWER    |    Space      |    LSIHT      |               |   R_SHIFT  |      ENTER   |     none      |               |               |       R_SHIFT |
            // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        Num_layer {
            bindings = <
                &kp N1       &kp N2       &kp N3       &kp N4       &kp N5      &kp ESC                         &kp N6       &kp N7      &kp N8     &kp N9      &kp N0
                &kp LS(N1)   &kp LS(N2)   &kp LS(N3)   &kp LS(N4)   &kp LS(N5)  &none                           &kp RS(N6)   &kp RS(N7)  &kp RS(N8) &kp RS(N9)  &kp RS(N0)
                &kp F1       &kp F2       &kp F3       &kp F4       &kp F5      &kp TAB                         &kp APOS     &kp EQUAL   &kp BSLH   &kp GRAVE   &kp INS
                &mo LSHIFT                             &mo 5     &kp SPACE   &kp LSHIFT          &kp F11   &kp RSHIFT   &kp ENTER   &none                  &kp RSHIFT
            >;
        };
            // ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            // |     F1      |     F2     |     F3     |     F4     |    F5      |    none    |                |            |    F6      |    F7      |    F8      |    F9       |     F10     |
            // |     F11     |     F12    |     F13    |     F14    |    F15     |    none    |                |   none     |    F16     |    F17     |    F18     |    F19      |     F20     |
            // |     none    |    none    |    none    |    none    |   none     |    none    |                |   none     |    none    |    none    |    none    |    none     |     none    |
            // |     L_SHIFT |    none    |    none    |    none    |   none     |    none    |                |   none     |    none    |    none    |    none    |    none     |     R_SHIFT |
            // ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        Func_layer {
            bindings = <
                &kp F1       &kp F2       &kp F3       &kp F4        &kp F5      &none                        &kp F6       &kp F7       &kp F8     &kp F9      &kp F10
                &kp F11      &kp F12      &kp F13      &kp F14       &kp F15     &none                        &kp F16      &kp F17      &kp F18    &kp F19     &kp F20
                &none        &none        &none        &none         &none       &none                        &none        &none        &none      &none       &none
                &kp LSHIFT                             &none         &none       &none             &none      &none        &none        &none                  &kp RSHIFT
            >;
        };
            // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            // |    none    |    none    |    none    |    none    |   none     |    none    |                  |            |    none    |    none    |    none    |   none     |    none    |
            // |  BT_SEL 0  |  BT_SEL 1  |  BT_SEL 2  |  BT_SEL 3  |   none     |    none    |                  |            |    none    |    none    |    none    |   BT_CLR   | BT_CLR_ALL |
            // |    none    |    none    |    none    |    none    |   none     |    none    |                  |    none    |    none    |   BT_PRV   |    none    |   BT_NXT   |    none    |
            // |    none    |    none    |    none    |    none    |   none     |    none    |                  |    none    |    none    |    none    |    none    |   none     |    none    |
            // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        Bt_layer {
            bindings = <
                &bt BT_SEL 0 &bt BT_SEL 1 &bt BT_SEL 2 &bt BT_SEL 3  &bt BT_SEL 4 &bt BT_SEL 5                  &none        &none        &none        &bt BT_CLR   &bt BT_CLR_ALL
                &none        &none        &none        &none         &none        &none                         &none        &bt BT_PRV   &none        &bt BT_NXT   &none
                &none        &none        &none        &none         &none        &none                         &none        &none        &none        &none        &none
                &none                                  &none         &none        &none             &none       &none        &none        &none                     &none
            >;
        };
    };
};
